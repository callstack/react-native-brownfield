# Getting Started

This guide walks you through setting up Brownie from scratch and then integrating it per platform.

## Prerequisites

Before starting, ensure you have:

- Completed the [React Native Brownfield Quick Start](/docs/getting-started/quick-start) guide
- Completed the [iOS Integration](/docs/getting-started/ios) guide
- Completed the [Android Integration](/docs/getting-started/android) guide
- React Native project with `@callstack/react-native-brownfield` installed
- Native host app (iOS and/or Android)
- Xcode 15+ (for iOS)
- Android Studio (for Android)

## Shared Setup

### Step 1: Install Brownie

In your React Native app:

```bash
npm install @callstack/brownie
```

### Step 2: Define Your Store

Create a store definition file with the `.brownie.ts` extension:

```ts
// src/stores/AppStore.brownie.ts
import type { BrownieStore } from '@callstack/brownie';

interface AppStore extends BrownieStore {
  counter: number;
}

declare module '@callstack/brownie' {
  interface BrownieStores {
    AppStore: AppStore;
  }
}
```

Import the store in your app entry point:

```ts
// App.tsx
import './stores/AppStore.brownie';
```

### Step 3: Use the Store in React Native

```tsx
import { useStore } from '@callstack/brownie';

function Counter() {
  const [counter, setState] = useStore('AppStore', (s) => s.counter);

  return (
    <View>
      <Text>Count: {counter}</Text>
      <Button
        title="Increment"
        onPress={() => setState((prev) => ({ counter: prev.counter + 1 }))}
      />
    </View>
  );
}
```

## iOS

### Step 4: Build XCFrameworks

The CLI generates Swift types and builds iOS artifacts:

```bash
npx brownfield package:ios --scheme YourScheme --configuration Release
```

This produces files in `ios/.brownfield/package/`:

- `YourScheme.xcframework` - Your React Native module
- `Brownie.xcframework` - Shared state library
- `ReactBrownfield.xcframework` - Brownfield integration
- `hermesvm.xcframework` - JavaScript engine (or `hermes.xcframework` for RN < 0.82.0)

:::info
The `package:ios` command automatically runs `brownfield codegen` to generate Swift types from your `.brownie.ts` files.
:::

### Step 5: Add Frameworks to Native App

1. Open your native Xcode project
2. Drag all XCFrameworks from `ios/.brownfield/package/` into your project
3. In target settings → **General** → **Frameworks, Libraries, and Embedded Content**, set all to **Embed & Sign**

### Step 6: Register Store in Swift

In your app's entry point, register the store with initial state:

```swift
import Brownie
import ReactBrownfield
import SwiftUI

let initialState = AppStore(counter: 0)

@main
struct MyApp: App {
  init() {
    ReactNativeBrownfield.shared.startReactNative {
      print("React Native loaded")
    }

    AppStore.register(initialState)
  }

  var body: some Scene {
    WindowGroup {
      ContentView()
    }
  }
}
```

### Step 7: Use the Store in SwiftUI

```swift
import Brownie
import SwiftUI

struct CounterView: View {
  @UseStore(\AppStore.counter) var counter

  var body: some View {
    VStack {
      Text("Count: \(Int(counter))")
      Button("Increment") {
        $counter.set { $0 + 1 }
      }
    }
  }
}
```

## Android

### Step 4: Add gson dependency

Add the gson dependency to your android module for brownfield:

```kts
api("com.google.code.gson:gson:2.13.1")
```

Otherwise, you can also add it to your native App:

```kts
implementation("com.google.code.gson:gson:2.13.1")
```

### Step 5: Add AAR

The CLI generates Kotlin types and builds AAR:

```bash
npx brownfield package:android --module-name :YourModuleName --variant release
```

Once it succeeds, publish the AAR to local maven:

```bash
npx brownfield publish:android --module-name :YourModuleName
```

:::info
The `package:android` command automatically runs `brownfield codegen` to generate Kotlin types from your `.brownie.ts` files.
:::

### Step 6: Register Store in Android

Register once during app startup:

```kotlin
import com.callstack.brownie.registerStoreIfNeeded
import com.rnapp.brownfieldlib.AppStore

registerStoreIfNeeded(
  storeName = AppStore.STORE_NAME
) {
  AppStore(counter = 0.0)
}
```

### Step 7: Read and Update Store from Native UI

```kotlin
import com.callstack.brownie.StoreManager
import com.callstack.brownie.store
import com.rnapp.brownfieldlib.AppStore

val store = StoreManager.shared.store<AppStore>(AppStore.STORE_NAME)

// Read
val counter = store?.state?.counter ?: 0.0

// Update
store?.set { state ->
  state.copy(counter = state.counter + 1)
}

// Observe
val unsubscribe = store?.subscribe(
  selector = { state -> state.counter.toInt() },
  onChange = { updated -> println("Counter: $updated") }
)
```

## Done!

State changes now sync automatically between React Native and native host code on both platforms.

## Next Steps

- [Defining Stores](/docs/api-reference/brownie/store-definition) - Nested objects and multiple stores
- [TypeScript Usage](/docs/api-reference/brownie/typescript-usage) - Advanced React Native patterns
- [Swift Usage](/docs/api-reference/brownie/swift-usage) - UIKit integration and API reference
- [Android Usage](/docs/api-reference/brownie/android-usage) - Kotlin setup, easy path, and advanced serializers
- [XCFramework Packaging](/docs/api-reference/brownie/xcframework-packaging) - SPM distribution and advanced options
