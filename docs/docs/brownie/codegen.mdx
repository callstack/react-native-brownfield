# Code Generation

The Brownfield CLI generates native types from your TypeScript store definitions.

## Usage

```bash
brownfield codegen                   # Generate for all configured platforms
brownfield codegen -p swift          # Generate Swift only
brownfield codegen --platform kotlin # Generate Kotlin only (coming soon)
brownfield --help                    # Show help
brownfield --version                 # Show version
```

## Configuration

Add to your app's `package.json`:

```json
{
  "brownie": {
    "kotlin": "./android/app/src/main/java/com/example/",
    "kotlinPackageName": "com.example"
  }
}
```

Note: This config is subject to change as Android support is rolled out. Ideally this will be removed in favor of auto-detection.

| Field               | Required | Description                                                |
| ------------------- | -------- | ---------------------------------------------------------- |
| `kotlin`            | No       | Output directory for Kotlin files                          |
| `kotlinPackageName` | No       | Kotlin package name (extracted from path if not specified) |

**Note:** Swift files are always generated to `node_modules/@callstack/brownie/ios/Generated/`. This path is auto-resolved and not configurable.

## Generated Output

For this TypeScript definition:

```ts
interface BrownfieldStore extends BrownieStore {
  counter: number;
  user: { name: string };
}
```

### Swift Output

Generated to: `node_modules/@callstack/brownie/ios/Generated/BrownfieldStore.swift`

```swift
import Brownie

public struct BrownfieldStore: Codable {
    public var counter: Double
    public var user: User
}

public struct User: Codable {
    public var name: String
}

extension BrownfieldStore: BrownieStoreProtocol {
    public static let storeName = "BrownfieldStore"
}
```

The generated struct:

- Uses `public` access level for framework compatibility
- Conforms to `Codable` for JSON serialization
- Conforms to `BrownieStoreProtocol` with auto-generated `storeName`
- Uses mutable `var` properties

### Kotlin Output (Coming Soon)

```kotlin
package com.example

data class BrownfieldStore(
    val counter: Double,
    val user: User
)

data class User(
    val name: String
)
```

## Auto-Generation Hooks

### iOS (Podfile)

Run codegen before pod install:

```ruby
pre_install do |installer|
  system("npx", "brownie", "codegen", "-p", "swift")
end
```

### Android (build.gradle.kts)

Run codegen before build:

```kotlin
tasks.register("generateBrownfieldStore") {
  exec { commandLine("npx", "brownie", "codegen", "-p", "kotlin") }
}
preBuild.dependsOn("generateBrownfieldStore")
```

## How It Works

1. CLI recursively finds all `*.brownie.ts` files
2. Parses `declare module '@callstack/brownie'` blocks using ts-morph
3. Extracts store names from `BrownieStores` interface
4. Generates native types using quicktype
